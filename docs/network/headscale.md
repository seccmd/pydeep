# Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale

## å¿«é€ŸæŒ‡ä»¤

- https://headscale.net/stable/setup/install/container/

```bash

## Windows å®‰è£…åŒ…
https://pkgs.tailscale.com/stable/tailscale-setup-1.86.0-amd64.msi

## Linux å®‰å…¨
curl -fsSL https://tailscale.com/install.sh | sh

## æ³¨å†ŒæœåŠ¡
tailscale up --login-server https://headscale.home.xxx.com/

## æ“ä½œå‘½ä»¤
headscale users list
headscale users create u01

docker exec -it headscale headscale users create u01
docker exec -it headscale headscale nodes register --user u01 --key <key>

docker exec -it headscale headscale preauthkeys create --user 1 --reusable --expiration 24h
tailscale up --login-server <YOUR_HEADSCALE_URL> --authkey <YOUR_AUTH_KEY>

docker exec -it headscale headscale nodes list
docker exec -it headscale headscale nodes delete -i <ID>
```


Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale æ§åˆ¶æœåŠ¡å™¨å®ç°ï¼Œä¸“ä¸ºè¿½æ±‚ç§æœ‰åŒ–éƒ¨ç½²ã€æ•°æ®è‡ªä¸»å¯æ§çš„ç”¨æˆ·è®¾è®¡ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒä»·å€¼ã€æŠ€æœ¯ç‰¹æ€§ã€éƒ¨ç½²æ–¹æ¡ˆã€åº”ç”¨åœºæ™¯ç­‰ç»´åº¦ç³»ç»Ÿè§£æå…¶æ–¹æ¡ˆè®¾è®¡ï¼š

---

### ğŸ”§ ä¸€ã€æ ¸å¿ƒå®šä½ä¸ç§æœ‰åŒ–ä»·å€¼

1. **Tailscale çš„æ›¿ä»£æ§åˆ¶é¢**  

    Headscale å®Œå…¨å¤åˆ» Tailscale æ§åˆ¶é¢é€»è¾‘ï¼Œå…¼å®¹å®˜æ–¹å®¢æˆ·ç«¯ï¼Œä½†å°†æ§åˆ¶æœåŠ¡å™¨ä» SaaS äº‘ç«¯è¿ç§»è‡³ç”¨æˆ·è‡ªæœ‰ç¯å¢ƒï¼Œå®ç°ï¼š

    - **æ•°æ®ä¸»æƒ**ï¼šæ‰€æœ‰èŠ‚ç‚¹æ³¨å†Œä¿¡æ¯ã€ACL ç­–ç•¥ã€é€šä¿¡çŠ¶æ€å‡å­˜å‚¨äºç§æœ‰æ•°æ®åº“ï¼ˆSQLite/PostgreSQLï¼‰ï¼›
    - **æ— è®¾å¤‡é™åˆ¶**ï¼šå¼€æºç‰ˆæœ¬æ— è®¾å¤‡æ•°é‡æˆ–åŠŸèƒ½é™åˆ¶ï¼Œä¼ä¸šå¯è‡ªç”±æ‰©å±•ï¼›
    - **åè®®å…¼å®¹æ€§**ï¼šåŸºäº WireGuard åè®®æ„å»ºç‚¹å¯¹ç‚¹åŠ å¯†éš§é“ï¼Œä¿ç•™é«˜æ•ˆç©¿é€ä¸ä½å»¶è¿Ÿç‰¹æ€§ã€‚
2. **è§£å†³ SaaS ç—›ç‚¹**  

    é’ˆå¯¹ Tailscale å®˜æ–¹æœåŠ¡çš„ä¸è¶³ï¼š

    - **åˆè§„æ€§**ï¼šæ»¡è¶³é‡‘èã€æ”¿ä¼ç­‰åœºæ™¯çš„æœ¬åœ°åŒ–éƒ¨ç½²éœ€æ±‚ï¼›
    - **ç½‘ç»œä¼˜åŒ–**ï¼šè‡ªå»º DERP ä¸­ç»§èŠ‚ç‚¹ï¼Œé¿å…è·¨å›½æµé‡ç»•è¡Œï¼ˆå¦‚å›½å†…è®¿é—®å®˜æ–¹èŠ‚ç‚¹å»¶è¿Ÿé«˜ï¼‰ï¼›
    - **è‡ªå®šä¹‰æ‰©å±•**ï¼šæ”¯æŒä¸ LDAP/SSO é›†æˆã€è‡ªå®šä¹‰ ACL ç­–ç•¥ç­‰ã€‚

---

### âš™ï¸ äºŒã€åŠŸèƒ½ç‰¹æ€§ä¸æŠ€æœ¯ä¼˜åŠ¿

|**èƒ½åŠ›æ¨¡å—**|**å…³é”®ç‰¹æ€§**|**æŠ€æœ¯ä»·å€¼**|
|-|-|-|
|**ç½‘ç»œæ¶æ„**|åŸºäº NAT ç©¿é€çš„ç½‘çŠ¶æ‹“æ‰‘ï¼ˆP2P ä¼˜å…ˆï¼Œä¸­ç»§å¤‡ç”¨ï¼‰|å‡å°‘ä¸­è½¬å¸¦å®½æˆæœ¬ï¼Œç›´è¿å»¶è¿Ÿä½è‡³ 10ms çº§|
|**è®¤è¯ä¸æƒé™**|æ”¯æŒé¢„æˆæƒå¯†é’¥ã€OIDC å•ç‚¹ç™»å½•ã€å¤šå‘½åç©ºé—´éš”ç¦»|çµæ´»å¯¹æ¥ä¼ä¸š IAM ç³»ç»Ÿï¼Œå®ç°ç§Ÿæˆ·éš”ç¦»|
|**ç­–ç•¥æ§åˆ¶**|ç²¾ç»†åŒ– ACL ç­–ç•¥ï¼ˆæŒ‰ IP/ç«¯å£/åè®®é™åˆ¶è®¿é—®ï¼‰ï¼ŒMagicDNS è‡ªåŠ¨åŸŸåè§£æ|æ›¿ä»£ä¼ ç»Ÿé˜²ç«å¢™è§„åˆ™ï¼ŒåŠ¨æ€ç®¡æ§è®¾å¤‡é€šä¿¡|
|**ä¸­ç»§æœåŠ¡**|å†…ç½®æˆ–è‡ªå»º DERP æœåŠ¡å™¨ï¼Œæ”¯æŒ UDP/TCP ä¸­ç»§|ç©¿é€ä¸¥æ ¼ NAT ç¯å¢ƒï¼Œæå‡è¿æ¥æˆåŠŸç‡|
|**è¿ç»´æ”¯æŒ**|é›†æˆ Prometheus ç›‘æ§ã€æ—¥å¿—å®¡è®¡ã€API é©±åŠ¨è‡ªåŠ¨åŒ–|ä¼ä¸šçº§å¯è§‚æµ‹æ€§ä¸è‡ªåŠ¨åŒ–è¿ç»´|


---

### ğŸš€ ä¸‰ã€éƒ¨ç½²æ–¹æ¡ˆä¸å®è·µè·¯å¾„

#### **1. åŸºç¡€éƒ¨ç½²ï¼ˆäºŒè¿›åˆ¶/Systemdï¼‰**

- **é€‚ç”¨åœºæ™¯**ï¼šå•æœåŠ¡å™¨å¿«é€Ÿéƒ¨ç½²  
- **æ­¥éª¤æ¦‚è¦**ï¼š
    1. ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å¹¶é…ç½®ï¼š

```Bash
wget https://github.com/juanfont/headscale/releases/download/v0.26.1/headscale_0.26.1_linux_amd64 -O /usr/local/bin/headscale
chmod +x /usr/local/bin/headscale
```
    2. åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/headscale/config.yaml`ï¼Œå…³é”®é…ç½®ï¼š

```YAML
server_url: https://47.76.253.98  # å…¬ç½‘è®¿é—®åœ°å€
listen_addr: 0.0.0.0:8080
ip_prefixes: [100.64.0.0/10]  # å®¢æˆ·ç«¯åˆ†é… IP æ®µ
derp:
  server:
    enabled: true
    region_id: 999  # è‡ªå®šä¹‰åŒºåŸŸ IDï¼ˆé¿å…ä¸å…¬å…± DERP å†²çªï¼‰
    region_code: "selfhosted"
    region_name: "Self-hosted DERP"
    stun_listen_addr: "0.0.0.0:3478"  # STUN æœåŠ¡ç«¯å£
    private_key_path: /etc/headscale/derp_private.key
noise:
  private_key_path: /etc/headscale/noise_private.key  # è‡ªåŠ¨ç”Ÿæˆå¯†é’¥æ–‡ä»¶
dns:
  magic_dns: true  # å¯ç”¨ MagicDNS
  base_domain: "my.local"  # æ›¿æ¢ä¸ºä½ çš„ç§æœ‰åŸŸååç¼€
  override_local_dns: true
  nameservers:
    global:
      - "1.1.1.1"
      - "8.8.8.8"
# å¿…é¡»é…ç½®çš„ IP åœ°å€æ± 
prefixes:
  v4: 100.64.0.0/10         # IPv4 åœ°å€æ®µï¼ˆå¿…é€‰ï¼‰
  # v6: fd7a:115c:a1e0::/48 # å¯é€‰ IPv6 æ®µ
allocation: sequential      # IP åˆ†é…ç­–ç•¥ï¼ˆsequential æˆ– randomï¼‰

database:
  type: sqlite  # æˆ– postgres
  sqlite:
    path: /opt/jupyter-lab/headscale/db.sqlite  # SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
```
    3. é€šè¿‡ Systemd æ‰˜ç®¡æœåŠ¡ã€‚

```Bash
headscale users list
headscale users create u01

å…¶ä»–æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨é¢„æˆæƒå¯†é’¥â€‹
ä¸ºé¿å…æ‰‹åŠ¨æ³¨å†Œï¼Œå¯ç”Ÿæˆé¢„æˆæƒå¯†é’¥ï¼ˆé€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰ï¼š
headscale preauthkeys create -u 1

å®¢æˆ·ç«¯ç›´æ¥é€šè¿‡å¯†é’¥è¿æ¥ï¼šæ­¤æ–¹å¼æ— éœ€æ‰‹åŠ¨æ‰§è¡Œ nodes register å‘½ä»¤

tailscale up --login-server=http://47.76.253.98:8080 --authkey 15f46f928e6d5b421c08608f42978253dab8dedc49c5bc8d


```

#### **2. å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker/K8sï¼‰**

- **é€‚ç”¨åœºæ™¯**ï¼šéœ€å¼¹æ€§æ‰©ç¼©å®¹æˆ–é›†æˆäº‘åŸç”Ÿä½“ç³»  
- **æ–¹æ¡ˆè¦ç‚¹**ï¼š
    - **Docker Compose**ï¼šé…ç½®ç«¯å£æ˜ å°„ä¸æŒä¹…åŒ–å·ï¼›
    - **Kubernetes**ï¼šé€šè¿‡ Ingress æš´éœ²æœåŠ¡ï¼Œç»“åˆ CSI å­˜å‚¨æ•°æ®åº“ï¼›
    - **Sealos ä¸€é”®éƒ¨ç½²**ï¼šäº‘åŸç”Ÿåº”ç”¨æ¨¡æ¿ï¼Œ15 ç§’å®Œæˆéƒ¨ç½²ï¼ˆå«å¯è§†åŒ–æ§åˆ¶å°ï¼‰ã€‚

#### **3. å®¢æˆ·ç«¯æ¥å…¥**

- **å‘½ä»¤ç¤ºä¾‹ï¼ˆLinuxï¼‰**ï¼š

```Bash
tailscale up --login-server=http://<HEADSCALE_IP>:8080 --accept-dns=false
```

    è®¿é—®è¿”å›çš„ URL å®Œæˆæ³¨å†Œï¼Œæˆ–åœ¨ Headscale æ‰§è¡Œï¼š

```Bash
headscale nodes register --user <å‘½åç©ºé—´> --key <è®¾å¤‡å¯†é’¥>
```
- **è·¨å¹³å°æ”¯æŒ**ï¼šWindows/macOS å®¢æˆ·ç«¯éœ€ä¿®æ”¹é…ç½®æŒ‡å‘è‡ªå»ºæœåŠ¡å™¨ï¼›Android/iOS éœ€ä¾§è½½ä¿®æ”¹ç‰ˆå®¢æˆ·ç«¯ã€‚

Headscale å®¢æˆ·ç«¯çš„æ¥å…¥æ–¹æ³•å› æ“ä½œç³»ç»Ÿè€Œå¼‚ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦å¹³å°çš„è¯¦ç»†æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼š

---

### **1. Linux å®¢æˆ·ç«¯æ¥å…¥**

#### **æ­¥éª¤**ï¼š

1. **å®‰è£… Tailscale å®¢æˆ·ç«¯**  

```Bash
wget https://pkgs.tailscale.com/stable/tailscale_1.22.2_amd64.tgz  # ä¸‹è½½å¯¹åº”ç‰ˆæœ¬
tar zxvf tailscale_*.tgz
cp tailscale_*/tailscale /usr/bin/tailscale
cp tailscale_*/tailscaled /usr/sbin/tailscaled
chmod +x /usr/bin/tailscale /usr/sbin/tailscaled
```
2. **æ³¨å†ŒæœåŠ¡å¹¶å¯åŠ¨**  

```Bash
cp tailscale_*/systemd/tailscaled.service /lib/systemd/system/
systemctl enable --now tailscaled
```
3. **è¿æ¥åˆ° Headscale æœåŠ¡å™¨**  

```Bash
tailscale up --login-server=http://<HEADSCALE_IP>:8080 --accept-dns=false
```
    - æ‰§è¡Œåä¼šç”Ÿæˆæ³¨å†Œé“¾æ¥ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¹¶åœ¨ Headscale æœåŠ¡ç«¯æ‰§è¡Œç±»ä¼¼ä»¥ä¸‹å‘½ä»¤å®Œæˆæ³¨å†Œï¼š  

```Bash
headscale nodes register --user <USERNAME> --key <KEY>
```

#### **æ³¨æ„äº‹é¡¹**ï¼š

- è‹¥éœ€éäº¤äº’å¼æ³¨å†Œï¼Œå¯ä½¿ç”¨é¢„æˆæƒå¯†é’¥ï¼š  

```Bash
tailscale up --login-server=http://<HEADSCALE_IP>:8080 --authkey <PREAUTH_KEY>
```

---

### **2. macOS å®¢æˆ·ç«¯æ¥å…¥**

#### **æ­¥éª¤**ï¼š

1. **å®‰è£… Tailscale å®¢æˆ·ç«¯**  
    - é€šè¿‡ [https://tailscale.com/downloadä¸‹è½½](https://tailscale.com/downloadä¸‹è½½) macOS ç‰ˆå®‰è£…åŒ…ã€‚
2. **ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®**ï¼ˆå¯é€‰ï¼‰  
    - ç¼–è¾‘é…ç½®æ–‡ä»¶ `/etc/default/tailscaled`ï¼ŒæŒ‡å®š Headscale æœåŠ¡å™¨åœ°å€ã€‚
3. **è¿æ¥ Headscale**  

```Bash
tailscale up --login-server=http://<HEADSCALE_IP>:8080
```
    - åç»­æ“ä½œä¸ Linux ç±»ä¼¼ï¼Œéœ€åœ¨æœåŠ¡ç«¯æ‰¹å‡†æ³¨å†Œã€‚

---

### **3. Windows å®¢æˆ·ç«¯æ¥å…¥**

#### **æ­¥éª¤**ï¼š

1. **å®‰è£… Tailscale**  
    - ä¸‹è½½ Windows ç‰ˆå®‰è£…åŒ…å¹¶è¿è¡Œã€‚
2. **é€šè¿‡å‘½ä»¤è¡Œè¿æ¥**  

```PowerShell
tailscale.exe up --login-server=http://<HEADSCALE_IP>:8080
```
    - éœ€åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ³¨å†Œå‘½ä»¤ã€‚

---

### **4. å…¶ä»–å¹³å°æ³¨æ„äº‹é¡¹**

- **Android/iOS**ï¼š  
    - å®˜æ–¹å®¢æˆ·ç«¯ä¸æ”¯æŒè‡ªå®šä¹‰æœåŠ¡å™¨ï¼Œéœ€è‡ªè¡Œç¼–è¯‘ä¿®æ”¹ã€‚
- **OpenBSD/FreeBSD**ï¼š  
    - ä¸ Linux æ­¥éª¤ç±»ä¼¼ï¼Œéœ€ç¡®ä¿å†…æ ¸æ”¯æŒ TUN è®¾å¤‡ã€‚

---

### **é€šç”¨é…ç½®å»ºè®®**

1. **HTTPS å¿…éœ€æ€§**ï¼š  
    - ç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡ Nginx/Caddy åå‘ä»£ç† Headscale çš„ `server_url` ä¸º HTTPSï¼Œå¦åˆ™éƒ¨åˆ†åŠŸèƒ½ï¼ˆå¦‚ MagicDNSï¼‰å¯èƒ½å¤±æ•ˆã€‚
2. **é¢„æˆæƒå¯†é’¥**ï¼š  
    - ç”Ÿæˆä¸€æ¬¡æ€§æˆ–å¯å¤ç”¨çš„å¯†é’¥ç®€åŒ–æ‰¹é‡éƒ¨ç½²ï¼š  

```Bash
headscale preauthkeys create --user <USER> --expiry 24h
```
3. **é˜²ç«å¢™è§„åˆ™**ï¼š  
    - ç¡®ä¿å®¢æˆ·ç«¯å¯è®¿é—® Headscale çš„ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 8080ï¼‰å’Œ DERP ä¸­ç»§ç«¯å£ï¼ˆå¦‚ UDP 3478ï¼‰ã€‚

---

### **æ•…éšœæ’æŸ¥**

- **æ³¨å†Œå¤±è´¥**ï¼šæ£€æŸ¥ `server_url` æ˜¯å¦å¯è¾¾ï¼Œä¸”æœåŠ¡ç«¯æ—¥å¿—æ— æŠ¥é”™ã€‚
- **NAT ç©¿é€å¤±è´¥**ï¼šé€šè¿‡ `tailscale netcheck` ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº†å¤‡ç”¨ DERP ä¸­ç»§ã€‚

> æ›´å¤šå®¢æˆ·ç«¯ç®¡ç†å‘½ä»¤ï¼ˆå¦‚æŸ¥çœ‹èŠ‚ç‚¹ã€åˆ é™¤è®¾å¤‡ï¼‰å¯å‚è€ƒ `headscale nodes list` å’Œ `headscale nodes delete`ã€‚



åœ¨ Tailscale ä¸­ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹å¶å°”å¤„äºé `active` çŠ¶æ€ï¼ˆå¦‚ `offline` æˆ– `idle`ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ‰‹åŠ¨æ¿€æ´»æˆ–ä¸»åŠ¨æ¢æ´»ï¼š

---

### **1. å¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥**

#### **æ–¹æ³• 1ï¼šä½¿ç”¨ ****`tailscale up`**** é‡æ–°æ¿€æ´»**

åœ¨éæ´»è·ƒèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š

```Bash
tailscale up --reset
```

- `--reset` ä¼šå¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥ Tailscale ç½‘ç»œï¼Œå¹¶å°è¯•é‡æ–°å»ºç«‹ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰æˆ– DERP ä¸­ç»§è¿æ¥ã€‚

#### **æ–¹æ³• 2ï¼šé‡å¯ ****`tailscaled`**** æœåŠ¡**

```Bash
sudo systemctl restart tailscaled  # Linux
```

æˆ–ï¼ˆWindowsï¼‰ï¼š

```PowerShell
Restart-Service Tailscale
```

- é€‚ç”¨äºé•¿æ—¶é—´æœªé€šä¿¡å¯¼è‡´çš„çŠ¶æ€å¼‚å¸¸ã€‚

---

### **2. æ‰‹åŠ¨è§¦å‘ NAT ç©¿é€æ£€æŸ¥**

æ‰§è¡Œ `tailscale netcheck` æ£€æŸ¥å½“å‰ç½‘ç»œç¯å¢ƒï¼š

```Bash
tailscale netcheck
```

- è¾“å‡ºä¼šæ˜¾ç¤º NAT ç©¿é€çŠ¶æ€ï¼ˆå¦‚ `UDP blocked` æˆ– `DERP relay`ï¼‰ï¼Œå¸®åŠ©åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´é˜²ç«å¢™æˆ–è·¯ç”±å™¨è®¾ç½®ã€‚

---

### **3. ä½¿ç”¨ ****`ping`**** æˆ– ****`curl`**** ä¸»åŠ¨æ¢æ´»**

åœ¨èŠ‚ç‚¹ A ä¸Šä¸»åŠ¨è®¿é—®èŠ‚ç‚¹ B çš„ Tailscale IPï¼š

```Bash
ping 100.64.0.4  # æ›¿æ¢ä¸ºç›®æ ‡èŠ‚ç‚¹çš„ Tailscale IP
```

æˆ–æµ‹è¯•ç«¯å£è¿é€šæ€§ï¼š

```Bash
curl http://100.64.0.4:8080  # æµ‹è¯• HTTP æœåŠ¡
```

- ä¸»åŠ¨æµé‡ä¼šè§¦å‘ Tailscale è‡ªåŠ¨å°è¯•å»ºç«‹è¿æ¥ã€‚

---

### **4. æ£€æŸ¥å¹¶ä¿®å¤ DERP ä¸­ç»§è¿æ¥**

å¦‚æœèŠ‚ç‚¹ä¾èµ– DERP ä¸­ç»§ï¼ˆå¦‚ `relay "selfhosted"`ï¼‰ï¼Œéœ€ç¡®ä¿è‡ªå»º DERP æœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼š

```Bash
# åœ¨ DERP æœåŠ¡å™¨ä¸Šæ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status headscale
```

- å¦‚æœ DERP ä¸å¯ç”¨ï¼ŒèŠ‚ç‚¹å¯èƒ½æ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œéœ€ä¿®å¤ DERP æœåŠ¡æˆ–æ”¹ç”¨å®˜æ–¹ä¸­ç»§ã€‚

---

### **5. è°ƒæ•´ Keepalive è®¾ç½®ï¼ˆé«˜çº§ï¼‰**

åœ¨ `/etc/default/tailscaled`ï¼ˆLinuxï¼‰æˆ–æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰ä¸­å¢åŠ  Keepalive é—´éš”ï¼š

```Ini
TS_DEBUG_KEEPALIVE=30s  # é»˜è®¤ 60sï¼Œç¼©çŸ­å¯æé«˜æ´»æ€§æ£€æµ‹é¢‘ç‡
```

- éœ€é‡å¯ `tailscaled` ç”Ÿæ•ˆã€‚

---

### **6. æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜**

```Bash
journalctl -u tailscaled -f  # Linux å®æ—¶æ—¥å¿—
```

æˆ–ï¼ˆWindowsï¼‰ï¼š

```PowerShell
Get-EventLog -LogName Application -Source Tailscale* -Newest 10
```

- å…³æ³¨ `magicsock` æˆ– `derp` ç›¸å…³é”™è¯¯ï¼Œå¦‚ `DERP reconnect failed`ã€‚

---

### **æ€»ç»“å»ºè®®**

1. **ä¸´æ—¶æ¢å¤**ï¼šä¼˜å…ˆä½¿ç”¨ `tailscale up --reset` æˆ–é‡å¯æœåŠ¡ã€‚  
2. **é•¿æœŸç¨³å®š**ï¼šæ£€æŸ¥é˜²ç«å¢™/NAT è§„åˆ™ï¼Œç¡®ä¿ UDP 41641 å’Œ DERP ç«¯å£ï¼ˆå¦‚ 3478ï¼‰å¼€æ”¾ã€‚  
3. **ç›‘æ§å·¥å…·**ï¼šç»“åˆ `tailscale status --json` è¾“å‡ºè‡ªåŠ¨åŒ–ç›‘æ§èŠ‚ç‚¹çŠ¶æ€ã€‚

> è‹¥é—®é¢˜æŒç»­ï¼Œæäº¤è¯Šæ–­æŠ¥å‘Šï¼š`tailscale bugreport`ï¼Œå¹¶é™„ä¸Šæ—¥å¿—ã€‚

---

### ğŸ¢ å››ã€ä¼ä¸šçº§æ‰©å±•åœºæ™¯

1. **æ··åˆäº‘ç»„ç½‘**  

    æ‰“é€š AWS/Azure äº‘ä¸»æœºä¸æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼Œæ›¿ä»£ä¸“çº¿ VPNï¼Œé€šè¿‡ ACL é™åˆ¶äº‘æ•°æ®åº“ä»…å†…ç½‘è®¿é—®ã€‚
2. **é›¶ä¿¡ä»»å®‰å…¨ä½“ç³»**  
    - è®¾å¤‡åŒå‘è®¤è¯ï¼ˆWireGuard å¯†é’¥ + ç”¨æˆ·èº«ä»½ï¼‰ï¼›
    - å¾®éš”ç¦»ç­–ç•¥ï¼ˆå¦‚ç ”å‘ç»„ä»…èƒ½è®¿é—®æµ‹è¯•ç¯å¢ƒ IP æ®µï¼‰ã€‚
3. **IoT è®¾å¤‡äº’è”**  

    åµŒå…¥å¼è®¾å¤‡ï¼ˆOpenWRT è·¯ç”±å™¨ï¼‰æ¥å…¥ï¼Œå®ç°è¿œç¨‹ç®¡ç†ä¸å®‰å…¨æ›´æ–°ã€‚

---

### âš–ï¸ äº”ã€å¯¹æ¯”é€‰å‹å»ºè®®

|**æ–¹æ¡ˆ**|**è‡ªæ‰˜ç®¡å¤æ‚åº¦**|**åè®®æ€§èƒ½**|**ä¼ä¸šçº§ç‰¹æ€§**|**é€‚ç”¨åœºæ™¯**|
|-|-|-|-|-|
|**Headscale**|ä¸­ â˜…â˜…â˜†|WireGuardï¼ˆç”¨æˆ·æ€ï¼‰|å¤šç§Ÿæˆ·éš”ç¦»ã€ACL å¼ºæ§|ä¸­å¤§å‹ä¼ä¸šã€åˆè§„ä¸¥æ ¼åœºæ™¯|
|**NetBird**|é«˜ â˜…â˜…â˜…|WireGuardï¼ˆå†…æ ¸æ€ï¼‰|å®˜æ–¹æ”¯æŒå®Œå–„|éœ€å¼€ç®±å³ç”¨ã€è½»é‡çº§ç§æœ‰éƒ¨ç½²|
|**ZeroTier**|ä½ â˜…â˜†â˜†|è‡ªæœ‰åè®®|å…è´¹ç‰ˆåŠŸèƒ½å—é™|ä¸ªäººæˆ–å°å‹å›¢é˜Ÿå¿«é€Ÿç»„ç½‘|


> âœ… **Headscale æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **å®Œå…¨è‡ªä¸»å¯æ§**ï¼šä»æ•°æ®å­˜å‚¨åˆ°æµé‡ä¸­è½¬å…¨ç¨‹ç§æœ‰åŒ–ï¼›
- **æˆæœ¬ä¼˜åŒ–**ï¼šæ— éœ€æŒ‰è®¾å¤‡ä»˜è´¹ï¼Œä¸­ç»§æœåŠ¡å™¨å¯å¤ç”¨ç°æœ‰èµ„æºï¼›
- **ç”Ÿæ€å…¼å®¹**ï¼šå¤ç”¨ Tailscale å®¢æˆ·ç«¯ï¼Œé™ä½è¿ç§»æˆæœ¬ã€‚

---

### âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹

1. **åŸŸåä¸è¯ä¹¦**ï¼šå¿…é¡»é…ç½®æœ‰æ•ˆåŸŸå + HTTPSï¼ˆå¦åˆ™å®¢æˆ·ç«¯æ³¨å†Œå¤±è´¥ï¼‰ï¼Œå¯é€šè¿‡ Nginx/Caddy åå‘ä»£ç†è§£å†³ã€‚
2. **NAT ç©¿é€ä¼˜åŒ–**ï¼šè‹¥ç›´è¿å¤±è´¥ï¼Œéœ€æ£€æŸ¥é˜²ç«å¢™æ”¾è¡Œ UDP 3478 åŠ 49152-65535 ç«¯å£ï¼Œæˆ–å¼ºåŒ– DERP ä¸­ç»§ã€‚
3. **é«˜å¯ç”¨è®¾è®¡**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®® PostgreSQL æ›¿ä»£ SQLiteï¼Œå¹¶éƒ¨ç½²å¤šå‰¯æœ¬ Headscale æœåŠ¡ã€‚

---

**æ€»ç»“**ï¼šHeadscale æ˜¯å½“å‰ç§æœ‰åŒ–ç»„ç½‘æ–¹æ¡ˆä¸­**å¹³è¡¡åŠŸèƒ½ã€æ§åˆ¶æƒä¸åè®®æ€§èƒ½çš„ä¼˜é€‰**ï¼Œå°¤å…¶é€‚åˆéœ€å®šåˆ¶å®‰å…¨ç­–ç•¥ã€è§„é¿äº‘æœåŠ¡ä¾èµ–çš„ä¼ä¸šåœºæ™¯ã€‚ç»“åˆå¯è§†åŒ–å·¥å…· [https://github.com/next-admin/headscale-admin](https://github.com/next-admin/headscale-admin) å¯è¿›ä¸€æ­¥æå‡ç®¡ç†æ•ˆç‡ã€‚éƒ¨ç½²è¯¦è§ [https://headscale.net/](https://headscale.net/) åŠ [https://github.com/juanfont/headscaleã€‚](https://github.com/juanfont/headscaleã€‚)





